apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: adservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: adservice
  egress:
    - hosts:
        - istio-system/*
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: shippingservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: shippingservice
  egress:
    - hosts:
        - istio-system/*
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: recommendationservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: recommendationservice
  egress:
    - hosts:
        - istio-system/*
        - ./productcatalogservice.online-boutique.svc.cluster.local
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: productcatalogservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: productcatalogservice
  egress:
    - hosts:
        - istio-system/*
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: paymentservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: paymentservice
  egress:
    - hosts:
        - istio-system/*
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: loadgenerator
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: loadgenerator
  egress:
    - hosts:
        - istio-system/*
        - ./frontend.online-boutique.svc.cluster.local
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: frontend
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: frontend
  egress:
    - hosts:
        - istio-system/*
        - ./adservice.online-boutique.svc.cluster.local
        - ./cartservice.online-boutique.svc.cluster.local
        - ./checkoutservice.online-boutique.svc.cluster.local
        - ./currencyservice.online-boutique.svc.cluster.local
        - ./productcatalogservice.online-boutique.svc.cluster.local
        - ./recommendationservice.online-boutique.svc.cluster.local
        - ./shippingservice.online-boutique.svc.cluster.local
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: emailservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: emailservice
  egress:
    - hosts:
        - istio-system/*
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: currencyservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: currencyservice
  egress:
    - hosts:
        - istio-system/*
---
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: checkoutservice
  namespace: online-boutique
spec:
  workloadSelector:
    labels:
      app: checkoutservice
  egress:
    - hosts:
        - istio-system/*
        - ./cartservice.online-boutique.svc.cluster.local
        - ./currencyservice.online-boutique.svc.cluster.local
        - ./emailservice.online-boutique.svc.cluster.local
        - ./paymentservice.online-boutique.svc.cluster.local
        - ./productcatalogservice.online-boutique.svc.cluster.local
        - ./shippingservice.online-boutique.svc.cluster.local
